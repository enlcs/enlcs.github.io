<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Secure Password Generator</title>
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --danger: #d32f2f;
            --warning: #FFC107;
            --text: #333;
            --bg: #f5f5f5;
            --card-bg: white;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text: #eee;
                --bg: #121212;
                --card-bg: #1e1e1e;
            }
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            max-width: 100%;
            margin: 0;
            padding: 10px;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.5;
            font-size: 16px;
        }

        .container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            font-size: 1.5rem;
            margin-top: 0;
            color: var(--primary);
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 12px;
            margin: 5px 0 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text);
        }

        button {
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        button:active {
            opacity: 0.8;
        }

        #generate {
            background: var(--primary);
            color: white;
        }

        .copy {
            background: var(--secondary);
            color: white;
            margin-top: 0;
        }

        #password {
            font-family: 'Roboto Mono', monospace, sans-serif;
            font-size: 1rem;
            word-break: break-all;
            background: rgba(0,0,0,0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0 5px;
            line-height: 1.6;
        }

        .strength-meter {
            height: 8px;
            background: rgba(0,0,0,0.1);
            border-radius: 4px;
            margin: 15px 0 5px;
            overflow: hidden;
        }

        .strength-level {
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }

        .security-warning {
            font-size: 0.85rem;
            margin-top: 25px;
            padding: 12px;
            border-radius: 8px;
            background: rgba(255,0,0,0.1);
            border-left: 4px solid var(--danger);
        }

        .checksum {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.8rem;
            word-break: break-all;
            user-select: all;
        }

        @media (max-width: 480px) {
            body {
                padding: 8px;
                font-size: 15px;
            }

            .container {
                padding: 15px;
            }

            input, select, button {
                padding: 12px;
            }

            #password {
                font-size: 0.9rem;
                padding: 12px;
            }
        }

        @media screen and (-webkit-min-device-pixel-ratio:0) {
            select:focus,
            textarea:focus,
            input:focus {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Secure Password Generator</h1>
        <p>Generates passwords locally in your browser. Nothing is sent to servers.</p>

        <label for="master">Master Word:</label>
        <input type="text" id="master" autocomplete="off" enterkeyhint="next">

        <label for="site">Site Name:</label>
        <input type="text" id="site" autocomplete="off" enterkeyhint="next">

        <label for="salt">Secret Salt:</label>
        <input type="text" id="salt" autocomplete="off" enterkeyhint="next">

        <label for="length">Password Length (8-64):</label>
        <input type="number" id="length" value="40" min="8" max="64" enterkeyhint="next">

        <label for="symbols">Include Special Characters:</label>
        <select id="symbols" enterkeyhint="done">
            <option value="none" selected>No</option>
            <option value="paypal">Yes (PayPal-compatible)</option>
        </select>

        <button id="generate">Generate Password</button>

        <h3>Your Password:</h3>
        <div id="password">(will appear here)</div>
        <button class="copy" id="copy">Copy to Clipboard</button>

        <div class="strength-meter">
            <div class="strength-level" id="strength"></div>
        </div>
        <div id="strength-text">Password strength: -</div>

        <div class="security-warning">
            <strong>Security Verification:</strong><br>
            Current script SHA-256: <span class="checksum" id="checksum"></span><br>
            Compare with original: <span class="checksum">f4d5e2b7a9c8...</span><br><br>
            <small>For maximum security, download and use offline.</small>
        </div>
    </div>

    <script>
        // Initialize with fixed random seed for deterministic behavior
        let randomSeed = 0;

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('master').focus();

            const inputs = document.querySelectorAll('input, select');
            inputs.forEach((input, index) => {
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        if (index < inputs.length - 1) {
                            inputs[index + 1].focus();
                        } else {
                            document.getElementById('generate').click();
                        }
                    }
                });
            });
        });

        // Calculate checksum
        async function calculateChecksum() {
            try {
                const response = await fetch(window.location.href);
                const text = await response.text();
                const cleanText = text.replace(/<span class="checksum" id="checksum">.*?<\/span>/, '');
                const encoder = new TextEncoder();
                const data = encoder.encode(cleanText);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                document.getElementById('checksum').textContent = hashHex.substring(0, 12) + '...';
            } catch (e) {
                console.error("Checksum calculation failed:", e);
            }
        }

        calculateChecksum();

        // Deterministic random number generator
        function deterministicRandom() {
            const x = Math.sin(randomSeed++) * 10000;
            return x - Math.floor(x);
        }

        document.getElementById('generate').addEventListener('click', async function() {
            const master = document.getElementById('master').value;
            const site = document.getElementById('site').value;
            const salt = document.getElementById('salt').value;
            let length = parseInt(document.getElementById('length').value) || 40;
            const symbolMode = document.getElementById('symbols').value;

            length = Math.max(8, Math.min(64, length));

            if (!master || !site || !salt) {
                alert('Please fill all fields');
                return;
            }

            try {
                // Reset random seed based on inputs for deterministic behavior
                randomSeed = master.length + site.length + salt.length;

                const password = await generatePassword(master, site, salt, length, symbolMode);
                document.getElementById('password').textContent = password;
                updatePasswordStrength(password);
                document.getElementById('password').scrollIntoView({
                    behavior: 'smooth',
                    block: 'nearest'
                });
            } catch (e) {
                alert('Error generating password: ' + e.message);
            }
        });

        document.getElementById('copy').addEventListener('click', function() {
            const password = document.getElementById('password').textContent;
            if (password && password !== '(will appear here)') {
                navigator.clipboard.writeText(password)
                    .then(() => {
                        const originalText = this.textContent;
                        this.textContent = 'âœ“ Copied!';
                        setTimeout(() => {
                            this.textContent = originalText;
                        }, 2000);
                    })
                    .catch(() => alert('Failed to copy'));
            }
        });

        function updatePasswordStrength(password) {
            let strength = 0;
            strength += Math.min(50, password.length * 2);
            if (/[A-Z]/.test(password)) strength += 10;
            if (/[a-z]/.test(password)) strength += 10;
            if (/[0-9]/.test(password)) strength += 10;
            if (/[^A-Za-z0-9]/.test(password)) strength += 20;

            const strengthElem = document.getElementById('strength');
            const strengthText = document.getElementById('strength-text');

            strength = Math.max(0, Math.min(100, strength));
            strengthElem.style.width = strength + '%';

            if (strength < 40) {
                strengthElem.style.backgroundColor = 'var(--danger)';
                strengthText.textContent = 'Password strength: Weak';
            } else if (strength < 70) {
                strengthElem.style.backgroundColor = 'var(--warning)';
                strengthText.textContent = 'Password strength: Medium';
            } else {
                strengthElem.style.backgroundColor = 'var(--primary)';
                strengthText.textContent = 'Password strength: Strong';
            }
        }

        async function generatePassword(master, site, salt, length, symbolMode) {
            const inputString = master + site + salt;
            const encoder = new TextEncoder();
            const data = encoder.encode(inputString);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

            const numToLetter = {'0':'k','1':'l','2':'m','3':'n','4':'o',
                               '5':'p','6':'q','7':'r','8':'s','9':'t'};
            const paypalSymbols = '!@#$%^&*()';

            // Calculate fixed positions for special characters
            const symbolPositions = [];
            if (symbolMode === 'paypal') {
                const symbolCount = Math.floor(length / 3);
                for (let i = 0; i < symbolCount; i++) {
                    const pos = Math.floor(deterministicRandom() * length);
                    symbolPositions.push(pos);
                }
            }

            let password = [];
            for (let i = 0; i < length; i++) {
                let char = hashHex[i % 64]; // Wrap around if length > 64

                // Handle special characters first
                if (symbolMode === 'paypal' && symbolPositions.includes(i)) {
                    const symbolIndex = Math.floor(deterministicRandom() * paypalSymbols.length);
                    password.push(paypalSymbols[symbolIndex]);
                    continue;
                }

                // Number handling
                if (/[0-9]/.test(char)) {
                    if (i % 3 !== 0) {
                        char = numToLetter[char];
                    }
                }

                // Letter case handling
                if (/[a-f]/.test(char)) {
                    char = i % 2 === 0 ? char.toUpperCase() : char.toLowerCase();
                }

                password.push(char);
            }

            return password.join('');
        }
    </script>
</body>
</html>
